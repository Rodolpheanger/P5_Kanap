const cartInit=async()=>{const localStorageData=getLocalStorage();null==localStorageData?(alert("Votre panier est vide pour l'instant, mais vous pouvez y ajouter des articles en visitant notre page d'acceuil."),location.href="../html/index.html"):(await itemsDisplay(localStorageData),totalItemsQuantityDisplay(localStorageData),totalItemsPriceDisplay(localStorageData),modifyItemQuantityInit(localStorageData),deleteItemInit(localStorageData),setOrderInit(localStorageData))},getLocalStorage=()=>{const localStorageData=JSON.parse(window.localStorage.getItem("cart"));return localStorageData},setLocalStorage=cartData=>{const cartDataToStringnify=JSON.stringify(cartData);window.localStorage.setItem("cart",cartDataToStringnify)},fetchItemData=async itemId=>{try{const response=await fetch("http://localhost:3000/api/products/"+itemId);return data=await response.json()}catch(error){console.log(error),alert("Nous rencontrons actuellement des difficultés pour acceder à votre panier.\nMerci de réessayer ultèrieurement.\nVeuillez nous excuser pour la gêne occasionnée.")}},getItemId=entryId=>{const itemId=entryId;return itemId},getCartItemsContainer=article=>document.getElementById("cart__items").appendChild(article),createItemContainer=(itemId,itemColor,divImage,divItemContentContainer)=>{const article=document.createElement("article");return article.classList.add("cart__item"),article.dataset.id=`${itemId}`,article.dataset.color=`${itemColor}`,article.appendChild(divImage),article.appendChild(divItemContentContainer),article},createItemImageContainer=cartItemImage=>{const divImage=document.createElement("div");return divImage.classList.add("cart__item__img"),divImage.appendChild(cartItemImage),divImage},itemImageDisplay=(itemImageUrl,itemAltTxt)=>{const cartItemImage=document.createElement("img");return cartItemImage.setAttribute("src",itemImageUrl),cartItemImage.setAttribute("alt",itemAltTxt),cartItemImage},createItemContentContainer=(divItemContentDescriptionContainer,divItemContentSettingsContainer)=>{const divItemContentContainer=document.createElement("div");return divItemContentContainer.classList.add("cart__item__content"),divItemContentContainer.appendChild(divItemContentDescriptionContainer),divItemContentContainer.appendChild(divItemContentSettingsContainer),divItemContentContainer},createItemContentDescriptionContainer=(cartItemName,cartItemColor,cartItemPrice)=>{const divItemContentDescriptionContainer=document.createElement("div");return divItemContentDescriptionContainer.classList.add("cart__item__content__description"),divItemContentDescriptionContainer.appendChild(cartItemName),divItemContentDescriptionContainer.appendChild(cartItemColor),divItemContentDescriptionContainer.appendChild(cartItemPrice),divItemContentDescriptionContainer},itemNameDisplay=itemDataName=>{const cartItemName=document.createElement("h2");return cartItemName.textContent=itemDataName,cartItemName},itemColorDisplay=itemDataColor=>{const cartItemColor=document.createElement("p");return cartItemColor.textContent=itemDataColor,cartItemColor},itemPriceDisplay=itemDataPrice=>{const cartItemPrice=document.createElement("p");return cartItemPrice.textContent=itemDataPrice+" €",cartItemPrice},createItemContentSettingsContainer=(divItemContentSettingsQuantityContainer,divItemContentSettingsDeleteContainer)=>{const divItemContentSettingsContainer=document.createElement("div");return divItemContentSettingsContainer.classList.add("cart__item__content__settings"),divItemContentSettingsContainer.appendChild(divItemContentSettingsQuantityContainer),divItemContentSettingsContainer.appendChild(divItemContentSettingsDeleteContainer),divItemContentSettingsContainer},createItemContentSettingsQuantityContainer=(preTextItemQuantity,itemQuantityInput)=>{const divItemContentSettingsQuantityContainer=document.createElement("div");return divItemContentSettingsQuantityContainer.classList.add("cart__item__content__settings__quantity"),divItemContentSettingsQuantityContainer.appendChild(preTextItemQuantity),divItemContentSettingsQuantityContainer.appendChild(itemQuantityInput),divItemContentSettingsQuantityContainer},itemQuantityPreTextDisplay=()=>{const preTextItemQuantity=document.createElement("p");return preTextItemQuantity.textContent="Qté : ",preTextItemQuantity},itemQuantityInputDisplay=itemDataQuantity=>{const itemQuantityInput=document.createElement("input");return itemQuantityInput.classList.add("itemQuantity"),itemQuantityInput.setAttribute("type","number"),itemQuantityInput.setAttribute("name","itemQuantity"),itemQuantityInput.setAttribute("min","1"),itemQuantityInput.setAttribute("max","100"),itemQuantityInput.setAttribute("value",itemDataQuantity),itemQuantityInput},createItemContentSettingsDeleteContainer=itemContentSettingsDeleteButton=>{const divItemContentSettingsDeleteContainer=document.createElement("div");return divItemContentSettingsDeleteContainer.classList.add("cart__item__content__settings__delete"),divItemContentSettingsDeleteContainer.appendChild(itemContentSettingsDeleteButton),divItemContentSettingsDeleteContainer},itemContentSettingsDeleteButtonDisplay=()=>{const itemContentSettingsDeleteButton=document.createElement("p");return itemContentSettingsDeleteButton.classList.add("deleteItem"),itemContentSettingsDeleteButton.textContent="Supprimer",itemContentSettingsDeleteButton},itemDisplay=(entry,itemId,itemData)=>{const itemQuantityPreText=itemQuantityPreTextDisplay(),itemQuantityInput=itemQuantityInputDisplay(entry.quantity),itemContentSettingsDeleteButton=itemContentSettingsDeleteButtonDisplay(),itemContentSettingsDeleteContainer=createItemContentSettingsDeleteContainer(itemContentSettingsDeleteButton),itemContentSettingsQuantityContainer=createItemContentSettingsQuantityContainer(itemQuantityPreText,itemQuantityInput),itemContentSettingsContainer=createItemContentSettingsContainer(itemContentSettingsQuantityContainer,itemContentSettingsDeleteContainer),itemPrice=itemPriceDisplay(itemData.price),itemColor=itemColorDisplay(entry.color),itemName=itemNameDisplay(itemData.name),itemContentDescriptionContainer=createItemContentDescriptionContainer(itemName,itemColor,itemPrice),itemContentContainer=createItemContentContainer(itemContentDescriptionContainer,itemContentSettingsContainer),itemImage=itemImageDisplay(itemData.imageUrl,itemData.altTxt),itemImageContainer=createItemImageContainer(itemImage),itemContainer=createItemContainer(itemId,entry.color,itemImageContainer,itemContentContainer);getCartItemsContainer(itemContainer)},itemsDisplay=async localStorageData=>{for(const entry of localStorageData){const itemId=getItemId(entry.id),itemData=await fetchItemData(itemId);itemDisplay(entry,itemId,itemData)}},pushInEmptyItemQuantityArray=(itemQuantityArray,itemDataQuantity)=>{const itemDataQuantityToNumber=Number(itemDataQuantity);return itemQuantityArray.push(itemDataQuantityToNumber),itemQuantityArray},calculateTotalItemsQuantity=itemQuantityArray=>{let sumItemsQuantity=0;return sumItemsQuantity=itemQuantityArray.reduce((a,b)=>a+b),document.getElementById("totalQuantity").textContent=sumItemsQuantity,sumItemsQuantity},totalItemsQuantityDisplay=localStorageData=>{let itemQuantityArray=[];for(const entry of localStorageData)itemQuantityArray=pushInEmptyItemQuantityArray(itemQuantityArray,entry.quantity);calculateTotalItemsQuantity(itemQuantityArray)},calculateTotalPriceByItem=(itemQuantity,itemPrice)=>{const totalPriceByItem=itemQuantity*itemPrice;return totalPriceByItem},createItemsTotalPriceArray=(itemsTotalPriceArray,totalaPriceByItem)=>(itemsTotalPriceArray.push(totalaPriceByItem),itemsTotalPriceArray),calculateItemsTotalPrice=itemsTotalPriceArray=>{let itemsTotalPrice=0;return itemsTotalPrice=itemsTotalPriceArray.reduce((a,b)=>a+b),itemsTotalPrice},totalPriceDisplay=itemsTotalPrice=>document.getElementById("totalPrice").textContent=itemsTotalPrice,totalItemsPriceDisplay=async localStorageData=>{let itemsTotalPriceArray=[];for(const entry of localStorageData){const itemId=getItemId(entry.id),itemData=await fetchItemData(itemId),totalPriceByItem=calculateTotalPriceByItem(entry.quantity,itemData.price);itemsTotalPriceArray=createItemsTotalPriceArray(itemsTotalPriceArray,totalPriceByItem)}const itemsTotalPrice=calculateItemsTotalPrice(itemsTotalPriceArray);totalPriceDisplay(itemsTotalPrice)},getSelectedItemArticle=button=>{const itemArticle=button.closest("section > article"),itemId=itemArticle.dataset.id,itemColor=itemArticle.dataset.color;return{itemId:itemId,itemColor:itemColor}},modifyItemQuantity=(button,localStorageData,itemId,itemColor)=>{button.addEventListener("change",()=>{invalidItemQuantity(button,localStorageData),setNewItemQuantity(localStorageData,itemId,itemColor,button)})},setNewItemQuantity=(localStorageData,itemId,itemColor,button)=>{for(const entry of localStorageData)entry.id===itemId&&entry.color===itemColor&&button.value>0&&(entry.quantity=Number(button.value),setLocalStorage(localStorageData),button.setAttribute("value",entry.quantity),totalItemsQuantityDisplay(localStorageData),totalItemsPriceDisplay(localStorageData))},invalidItemQuantity=button=>{button.value<=0?(alert('La quantité minimum autorisée est de 1. Si vous souhaitez supprimer cet article, merci de cliquer sur "Supprimer"'),setQuantityToLocalStorageValue(button)):button.value>100&&(alert("La quantité maximum autorisée est de 100."),setQuantityToLocalStorageValue(button))},setQuantityToLocalStorageValue=button=>{button.value=button.getAttribute("value")},modifyItemQuantityInit=localStorageData=>{document.querySelectorAll(".itemQuantity").forEach(button=>{const{itemId:itemId,itemColor:itemColor}=getSelectedItemArticle(button);modifyItemQuantity(button,localStorageData,itemId,itemColor)})},deleteItemLaunch=(button,localStorageData,itemId,itemColor)=>{button.addEventListener("click",()=>{1==localStorageData.length?lastItemDelete():deleteOneItem(localStorageData,itemId,itemColor)})},lastItemDelete=()=>{confirm("Vous êtes sur le point de supprimer le dernier article présent dans votre panier.\nEn cliquant sur OK, vous serez redirigé vers notre page d'Accueil.\nSouhaitez-vous continuer ?")&&(localStorage.clear(),location.href="./index.html")},deleteOneItem=(localStorageData,itemId,itemColor)=>{for(const entry of localStorageData)entry.id===itemId&&entry.color===itemColor&&confirm("Vous allez supprimer cet article de votre panier. \nSouhaitez-vous continuer ?")&&(localStorageItemRemove(localStorageData,entry),itemRemove(itemId,entry),setLocalStorage(localStorageData),totalItemsQuantityDisplay(localStorageData),totalItemsPriceDisplay(localStorageData))},localStorageItemRemove=(localStorageData,entry)=>{localStorageData.splice(localStorageData.indexOf(entry),1)},itemRemove=(itemId,entry)=>{document.querySelector(`article[data-id="${itemId}"][data-color="${entry.color}"]`).remove()},deleteItemInit=localStorageData=>{document.querySelectorAll(".deleteItem").forEach(button=>{const{itemId:itemId,itemColor:itemColor}=getSelectedItemArticle(button);deleteItemLaunch(button,localStorageData,itemId,itemColor)})},formChecker=()=>{firstName.addEventListener("input",()=>{firstNameChecker()}),lastName.addEventListener("input",()=>{lastNameChecker()}),address.addEventListener("input",()=>{addressChecker()}),city.addEventListener("input",()=>{cityChecker()}),email.addEventListener("input",()=>{emailChecker()})},firstAndLastNameCondition=(inputId,errorMessageInput)=>/^[a-záàâäãåçéèêëíìîïñóòôöõúùûüýÿæœ'-\s]+$/i.test(inputId.value)?(errorMessageInput.textContent="",!0):(errorMessageInput.textContent="Saisie non valide: les chiffres et caractères spéciaux ne sont pas autorisés",!1),firstNameChecker=()=>{const firstNameErrorMsgInput=document.getElementById("firstNameErrorMsg");return firstAndLastNameCondition(firstName,firstNameErrorMsgInput)},lastNameChecker=()=>{const lastNameErrorMsgInput=document.getElementById("lastNameErrorMsg");return firstAndLastNameCondition(lastName,lastNameErrorMsgInput)},addressChecker=()=>{const addressErrorMsg=document.getElementById("addressErrorMsg");return/^[a-z0-9áàâäãåçéèêëíìîïñóòôöõúùûüýÿæœ,'-\s]+$/i.test(address.value)?(addressErrorMsg.textContent="",!0):(addressErrorMsg.textContent="Saisie non valide: les caractères spéciaux ne sont pas autorisés",!1)},cityChecker=()=>{const cityErrorMsg=document.getElementById("cityErrorMsg");return/^[0-9]{5}\s[a-z0-9áàâäãåçéèêëíìîïñóòôöõúùûüýÿæœ'-\s]+$/i.test(city.value)?(cityErrorMsg.textContent="",!0):(cityErrorMsg.textContent="Saisie non valide: saisir le code postal (5 chiffres), suivi du nom de la ville. Les caractères spéciaux ne sont pas autorisés",!1)},emailChecker=()=>{const emailErrorMsg=document.getElementById("emailErrorMsg");return/^(([^<>()[\]\\.,;:@\"\s]+(\.[^<>()[\]\\.,;:@\"\s]+)*))@(([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})|(([a-z0-9\-áàâäãåçéèêëíìîïñóòôöõúùûüýÿæœ]+\.)+[a-z]{2,}))$/i.test(email.value)?(emailErrorMsg.textContent="",!0):(emailErrorMsg.textContent="Format Email non valide",!1)},formValidity=()=>firstNameChecker()&&lastNameChecker()&&addressChecker()&&cityChecker()&&emailChecker(),getUserData=()=>({firstName:firstName.value,lastName:lastName.value,address:address.value,city:city.value,email:email.value}),getProductsId=localStorageData=>{const productsId=[];for(const entry of localStorageData)productsId.push(entry.id);return productsId},formSubmit=localStorageData=>{document.querySelector(".cart__order__form").addEventListener("submit",e=>{e.preventDefault();const formIsValid=formValidity();formIsValid?setOrder(localStorageData):alert("Veuillez corriger le(s) champ(s) non valide(s) du formulaire.")})},fetchPostOrder=async localStorageData=>{const productsId=getProductsId(localStorageData),userData=getUserData();try{const response=await fetch("http://localhost:3000/api/products/order",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({contact:userData,products:productsId})});return response.json()}catch(error){console.log(error),alert("Nous rencontrons actuellement des difficultés pour l'envoi de votre commande.\nMerci de réessayer ultèrieurement.\nVeuillez nous excuser pour la gêne occasionnée.")}},setOrder=async localStorageData=>{const orderId=await fetchPostOrder(localStorageData);localStorage.clear(),location.href=`../html/confirmation.html?orderId=${orderId.orderId}`},setOrderInit=localStorageData=>{formChecker(),formSubmit(localStorageData)};cartInit();